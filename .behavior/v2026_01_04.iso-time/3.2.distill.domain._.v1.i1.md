# distill: iso-time domain

domain objects and operations that fulfill the iso-time vision.

---

## usecases and contract envision

### usecase 1: type absolute instants

```ts
import { IsoTimeStamp, IsoDateStamp, IsoMonthStamp, IsoYearStamp } from 'iso-time';

const eventAt: IsoTimeStamp = '2024-01-15T14:30:00Z';
const eventOn: IsoDateStamp = '2024-01-15';
const period: IsoMonthStamp = '2024-01';
const year: IsoYearStamp = '2024';
```

### usecase 2: type detached patterns

```ts
import {
  IsoTimeFloat, IsoHourFloat, IsoMinuteFloat,
  IsoMonthFloat, IsoDayFloat, IsoWeekdayFloat
} from 'iso-time';

const standup: IsoTimeFloat = '09:00:00';
const hour: IsoHourFloat = '09';
const minute: IsoMinuteFloat = '30';
const renewMonth: IsoMonthFloat = '01';
const dueDay: IsoDayFloat = '15';
const meetingDay: IsoWeekdayFloat = '1';
```

### usecase 3: manipulate stamps

```ts
import { addDuration, getDuration } from 'iso-time';

const later: IsoTimeStamp = addDuration('2024-01-15T14:30:00Z', { hours: 2 });
const nextWeek: IsoDateStamp = addDuration('2024-01-15', { days: 7 });
const duration = getDuration({ since: '2024-01-15T14:30:00Z', until: '2024-01-15T16:30:00Z' });
```

### usecase 4: represent ranges

```ts
import { IsoTimeStampRange, IsoDateStampRange } from 'iso-time';

const window: IsoDateStampRange = { since: '2024-01-15', until: '2024-01-22' };
const session: IsoTimeStampRange = { since: '2024-01-15T14:30:00Z', until: '2024-01-15T16:30:00Z' };
```

### usecase 5: validate at runtime

```ts
import { isIsoTimeStamp, isIsoDateStamp, isIsoTimeFloat } from 'iso-time';

if (isIsoTimeStamp(input)) { /* input is IsoTimeStamp */ }
if (isIsoDateStamp(input)) { /* input is IsoDateStamp */ }
if (isIsoTimeFloat(input)) { /* input is IsoTimeFloat */ }
```

### usecase 6: get current time

```ts
import { now, today } from 'iso-time';

const currentTime: IsoTimeStamp = now();
const currentDate: IsoDateStamp = today();
```

---

## domain.objects

### stamps (absolute instants)

```ts
// src/domain.objects/IsoTimeStamp.ts
import type { AsOfGlossary } from 'domain-glossaries';

/**
 * .what = exact instant in history
 * .why = unambiguous UTC timestamp for events, logs, records
 * .format = yyyy-MM-ddTHH:mm:ssZ
 */
export type IsoTimeStamp = AsOfGlossary<string, 'iso-time.IsoTimeStamp'>;

/**
 * .what = exact day in history
 * .why = unambiguous date for appointments, deadlines, milestones
 * .format = yyyy-MM-dd
 */
export type IsoDateStamp = AsOfGlossary<
  string,
  'iso-time.IsoDateStamp' | 'iso-time.IsoTimeStamp' // timestamp is superset
>;

/**
 * .what = exact month in history
 * .why = unambiguous month for billing periods, reports
 * .format = yyyy-MM
 */
export type IsoMonthStamp = AsOfGlossary<string, 'iso-time.IsoMonthStamp'>;

/**
 * .what = exact year in history
 * .why = unambiguous year for annual records
 * .format = yyyy
 */
export type IsoYearStamp = AsOfGlossary<string, 'iso-time.IsoYearStamp'>;
```

### floats (detached patterns)

```ts
// src/domain.objects/IsoTimeFloat.ts
import type { AsOfGlossary } from 'domain-glossaries';

/**
 * .what = time of day pattern
 * .why = detached time for schedules, store hours, standups
 * .format = HH:mm:ss
 */
export type IsoTimeFloat = AsOfGlossary<string, 'iso-time.IsoTimeFloat'>;

/**
 * .what = hour of day pattern
 * .why = detached hour for hourly schedules
 * .format = HH (00-23)
 */
export type IsoHourFloat = AsOfGlossary<string, 'iso-time.IsoHourFloat'>;

/**
 * .what = minute of hour pattern
 * .why = detached minute for minute-level patterns
 * .format = mm (00-59)
 */
export type IsoMinuteFloat = AsOfGlossary<string, 'iso-time.IsoMinuteFloat'>;

/**
 * .what = month of year pattern
 * .why = detached month for annual renewals, fiscal periods
 * .format = MM (01-12)
 */
export type IsoMonthFloat = AsOfGlossary<string, 'iso-time.IsoMonthFloat'>;

/**
 * .what = day of month pattern
 * .why = detached day for monthly due dates, paydays
 * .format = dd (01-31)
 */
export type IsoDayFloat = AsOfGlossary<string, 'iso-time.IsoDayFloat'>;

/**
 * .what = day of week pattern
 * .why = detached weekday for weekly standups, recurring events
 * .format = d (1-7, monday=1)
 */
export type IsoWeekdayFloat = AsOfGlossary<string, 'iso-time.IsoWeekdayFloat'>;
```

### ranges

```ts
// src/domain.objects/IsoTimeStampRange.ts
import type { AsOfGlossary } from 'domain-glossaries';
import type { IsoTimeStamp } from './IsoTimeStamp';
import type { IsoDateStamp } from './IsoTimeStamp';

/**
 * .what = time range with since/until bounds
 * .why = represent sessions, windows, intervals
 * .note = since is inclusive, until is exclusive
 */
export type IsoTimeStampRange = AsOfGlossary<
  { since: IsoTimeStamp; until: IsoTimeStamp },
  'iso-time.IsoTimeStampRange',
  false
>;

/**
 * .what = date range with since/until bounds
 * .why = represent booking windows, periods, spans
 * .note = since is inclusive, until is exclusive
 */
export type IsoDateStampRange = AsOfGlossary<
  { since: IsoDateStamp; until: IsoDateStamp },
  'iso-time.IsoDateStampRange' | 'iso-time.IsoTimeStampRange',
  false
>;
```

### duration

```ts
// src/domain.objects/IsoDuration.ts
import type { AsOfGlossary } from 'domain-glossaries';
import type { PickAny } from 'type-fns';

/**
 * .what = duration between two instants
 * .why = represent time spans for arithmetic
 */
export type IsoDuration = AsOfGlossary<
  PickAny<{
    years: number;
    months: number;
    weeks: number;
    days: number;
    hours: number;
    minutes: number;
    seconds: number;
    milliseconds: number;
  }>,
  'iso-time.IsoDuration',
  false
>;
```

---

## domain.operations

### checks (validators + casters)

```ts
// src/domain.operations/checks/isIsoTimeStamp.ts
/**
 * .what = validates string is IsoTimeStamp format
 * .why = runtime validation for external input
 */
export const isIsoTimeStamp: (input: string) => input is IsoTimeStamp;
export const asIsoTimeStamp: (input: Date | string | number) => IsoTimeStamp;

// src/domain.operations/checks/isIsoDateStamp.ts
export const isIsoDateStamp: (input: string) => input is IsoDateStamp;
export const asIsoDateStamp: (input: Date | string | number) => IsoDateStamp;

// src/domain.operations/checks/isIsoMonthStamp.ts
export const isIsoMonthStamp: (input: string) => input is IsoMonthStamp;
export const asIsoMonthStamp: (input: Date | string | number) => IsoMonthStamp;

// src/domain.operations/checks/isIsoYearStamp.ts
export const isIsoYearStamp: (input: string) => input is IsoYearStamp;
export const asIsoYearStamp: (input: Date | string | number) => IsoYearStamp;

// src/domain.operations/checks/isIsoTimeFloat.ts
export const isIsoTimeFloat: (input: string) => input is IsoTimeFloat;

// src/domain.operations/checks/isIsoHourFloat.ts
export const isIsoHourFloat: (input: string) => input is IsoHourFloat;

// src/domain.operations/checks/isIsoMinuteFloat.ts
export const isIsoMinuteFloat: (input: string) => input is IsoMinuteFloat;

// src/domain.operations/checks/isIsoMonthFloat.ts
export const isIsoMonthFloat: (input: string) => input is IsoMonthFloat;

// src/domain.operations/checks/isIsoDayFloat.ts
export const isIsoDayFloat: (input: string) => input is IsoDayFloat;

// src/domain.operations/checks/isIsoWeekdayFloat.ts
export const isIsoWeekdayFloat: (input: string) => input is IsoWeekdayFloat;

// src/domain.operations/checks/isIsoTimeStampRange.ts
export const isIsoTimeStampRange: (input: unknown) => input is IsoTimeStampRange;

// src/domain.operations/checks/isIsoDateStampRange.ts
export const isIsoDateStampRange: (input: unknown) => input is IsoDateStampRange;
```

### manipulate (arithmetic)

```ts
// src/domain.operations/manipulate/addDuration.ts
/**
 * .what = adds duration to a stamp
 * .why = time arithmetic for scheduling, deadlines
 */
export function addDuration(stamp: IsoTimeStamp, duration: IsoDuration): IsoTimeStamp;
export function addDuration(stamp: IsoDateStamp, duration: IsoDuration): IsoDateStamp;
export function addDuration(stamp: IsoMonthStamp, duration: IsoDuration): IsoMonthStamp;

// src/domain.operations/manipulate/subDuration.ts
/**
 * .what = subtracts duration from a stamp
 * .why = reverse time arithmetic
 */
export function subDuration(stamp: IsoTimeStamp, duration: IsoDuration): IsoTimeStamp;
export function subDuration(stamp: IsoDateStamp, duration: IsoDuration): IsoDateStamp;
export function subDuration(stamp: IsoMonthStamp, duration: IsoDuration): IsoMonthStamp;

// src/domain.operations/manipulate/getDuration.ts
/**
 * .what = computes duration between two stamps
 * .why = measure time spans for analytics, billing
 */
export function getDuration(input: { since: IsoTimeStamp; until: IsoTimeStamp }): IsoDuration;
export function getDuration(input: { since: IsoDateStamp; until: IsoDateStamp }): IsoDuration;
```

### observe (current time)

```ts
// src/domain.operations/observe/now.ts
/**
 * .what = returns current UTC timestamp
 * .why = capture event times, log entries
 */
export const now: () => IsoTimeStamp;

// src/domain.operations/observe/today.ts
/**
 * .what = returns current UTC date
 * .why = capture current date for deadlines, reports
 */
export const today: () => IsoDateStamp;
```

### casts (format conversion)

```ts
// src/domain.operations/casts/toMilliseconds.ts
/**
 * .what = converts duration to milliseconds
 * .why = internal arithmetic, comparison
 */
export const toMilliseconds: (duration: IsoDuration) => number;

// src/domain.operations/casts/toMillisecondsSinceEpoch.ts
/**
 * .what = converts stamp to epoch milliseconds
 * .why = internal arithmetic, database storage
 */
export const toMillisecondsSinceEpoch: (stamp: IsoTimeStamp | IsoDateStamp) => number;
```

---

## access.daos

no daos required — this is a pure domain library with no persistence layer.

---

## file structure

```
src/
  domain.objects/
    IsoTimeStamp.ts        # IsoTimeStamp, IsoDateStamp, IsoMonthStamp, IsoYearStamp
    IsoTimeFloat.ts        # IsoTimeFloat, IsoHourFloat, IsoMinuteFloat, IsoMonthFloat, IsoDayFloat, IsoWeekdayFloat
    IsoTimeStampRange.ts   # IsoTimeStampRange, IsoDateStampRange
    IsoDuration.ts         # IsoDuration

  domain.operations/
    checks/
      isIsoTimeStamp.ts
      isIsoDateStamp.ts
      isIsoMonthStamp.ts
      isIsoYearStamp.ts
      isIsoTimeFloat.ts
      isIsoHourFloat.ts
      isIsoMinuteFloat.ts
      isIsoMonthFloat.ts
      isIsoDayFloat.ts
      isIsoWeekdayFloat.ts
      isIsoTimeStampRange.ts
      isIsoDateStampRange.ts

    manipulate/
      addDuration.ts
      subDuration.ts
      getDuration.ts
      toMilliseconds.ts

    observe/
      now.ts
      today.ts

    casts/
      toMillisecondsSinceEpoch.ts
      castInputToDate.ts

  index.ts                 # all exports
```

---

## migration mapping

| old (uni-time) | new (iso-time) |
|----------------|----------------|
| `UniDateTime` | `IsoTimeStamp` |
| `UniDate` | `IsoDateStamp` |
| `UniMonth` | `IsoMonthStamp` |
| `UniTime` | `IsoTimeFloat` |
| `UniDateRange` | `IsoDateStampRange` |
| `UniDateTimeRange` | `IsoTimeStampRange` |
| `UniDuration` | `IsoDuration` |
| `isUniDateTime` | `isIsoTimeStamp` |
| `isUniDate` | `isIsoDateStamp` |
| `isUniMonth` | `isIsoMonthStamp` |
| `asUniDateTime` | `asIsoTimeStamp` |
| `asUniDate` | `asIsoDateStamp` |
| `until` | `until` |

---

## new types (not in uni-time)

| type | format | purpose |
|------|--------|---------|
| `IsoYearStamp` | `yyyy` | exact year |
| `IsoHourFloat` | `HH` | hour pattern |
| `IsoMinuteFloat` | `mm` | minute pattern |
| `IsoMonthFloat` | `MM` | month pattern |
| `IsoDayFloat` | `dd` | day of month pattern |
| `IsoWeekdayFloat` | `d` | weekday pattern |
| `now()` | — | current timestamp |
| `today()` | — | current date |
