# roadmap.sumDurations

## overview

implement `sumDurations` operation to sum multiple `IsoDuration` values into one `IsoDurationShape`.

---

## phase 1: unit tests

### prereqs
- [ ] read `.behavior/v2026_01_22.sum-durations/3.2.distill.domain._.v1.i1.md`
- [ ] read `src/domain.operations/manipulate/getDuration.test.ts` for test patterns

### tasks
- [ ] create `src/domain.operations/manipulate/sumDurations.test.ts`
- [ ] add test case: spread syntax with object durations
- [ ] add test case: spread syntax with string durations (iso 8601)
- [ ] add test case: spread syntax with mixed formats
- [ ] add test case: array syntax
- [ ] add test case: array syntax with `{ as }` option
- [ ] add test case: empty array returns zero duration
- [ ] add test case: single duration returns that duration

### acceptance criteria
```ts
// spread syntax works
sumDurations({ hours: 1 }, { minutes: 30 }) // => { hours: 1, minutes: 30 }

// array syntax works
sumDurations([{ hours: 1 }, { minutes: 30 }]) // => { hours: 1, minutes: 30 }

// mixed formats work
sumDurations('PT1H', { minutes: 30 }) // => { hours: 1, minutes: 30 }

// { as } option works
sumDurations([{ hours: 1 }, { minutes: 30 }], { as: 'minutes' }) // => { minutes: 90 }
```

### verification
```sh
npm run test:unit -- sumDurations.test.ts
```
- [ ] all tests fail (no implementation yet)

---

## phase 2: implementation

### prereqs
- [ ] read `.behavior/v2026_01_22.sum-durations/3.2.distill.domain._.v1.i1.md` (code sketch section)
- [ ] read `src/domain.operations/manipulate/getDuration.ts` for pattern reference
- [ ] read `src/domain.operations/manipulate/toMilliseconds.ts` for dependency

### tasks
- [ ] create `src/domain.operations/manipulate/sumDurations.ts`
- [ ] add jsdoc header with `.what` and `.why`
- [ ] add function overloads for type safety:
  - `sumDurations(...durations: IsoDuration[]): IsoDurationShape`
  - `sumDurations(durations: IsoDuration[]): IsoDurationShape`
  - `sumDurations(durations: IsoDuration[], options: { as: keyof IsoDurationShape }): IsoDurationShape`
- [ ] implement input detection (spread vs array)
- [ ] implement summation via `toMilliseconds()`
- [ ] implement output via `getDuration()`

### acceptance criteria
- function accepts spread: `sumDurations(d1, d2, d3)`
- function accepts array: `sumDurations([d1, d2, d3])`
- function accepts array with options: `sumDurations([d1, d2], { as: 'minutes' })`
- function handles both `IsoDurationWords` and `IsoDurationShape` inputs

### verification
```sh
npm run test:unit -- sumDurations.test.ts
```
- [ ] all unit tests pass

---

## phase 3: export

### prereqs
- [ ] phase 2 complete (implementation passes tests)

### tasks
- [ ] add export to `src/index.ts`:
  ```ts
  export * from './domain.operations/manipulate/sumDurations';
  ```

### acceptance criteria
- `sumDurations` is importable from `iso-time` package root

### verification
```sh
npm run test:types
```
- [ ] type check passes

---

## phase 4: build verification

### prereqs
- [ ] phase 3 complete (export added)

### tasks
- [ ] run full build
- [ ] run full test suite

### acceptance criteria
- build compiles without errors
- all tests pass (unit, types, lint, format)

### verification
```sh
npm run build
npm run test
```
- [ ] build succeeds
- [ ] all tests pass

---

## phase 5: readme verification

### prereqs
- [ ] phase 4 complete (build passes)
- [ ] read `readme.md` sumDurations section

### tasks
- [ ] verify readme examples compile
- [ ] verify readme examples produce documented output

### acceptance criteria
- readme examples are accurate

### verification
- [ ] manual review of readme examples against implementation

---

## summary checklist

| phase | gate | status |
|-------|------|--------|
| 1. unit tests | tests written, fail without impl | [ ] |
| 2. implementation | unit tests pass | [ ] |
| 3. export | importable from package root | [ ] |
| 4. build | full build + test suite passes | [ ] |
| 5. readme | examples accurate | [ ] |

---

## notes

### dependencies (read before implementation)
- `toMilliseconds` — converts `IsoDuration` to milliseconds
- `getDuration` — converts milliseconds to `IsoDurationShape`

### no new domain objects
this operation reuses:
- `IsoDuration` (input type)
- `IsoDurationShape` (output type)
- `IsoDurationWords` (accepted input variant)

### no integration tests needed
this is a pure computation operation with no external dependencies
